{% extends 'base.html' %}

{% block title %}
    FlameDate - Perfil
{% endblock %}

{% block content %}
<div class="swipes-page d-flex">
  <!-- Sidebar -->
  <div class="sidebar d-flex flex-column align-items-center p-4 text-white">
    <div class="w-100 d-flex justify-content-start">
      <a href="{{ url_for('inicio') }}" class="back-arrow mb-4">
        <img src="{{ url_for('static', filename='images/arrow-back.png') }}" alt="Volver"/>
      </a>
    </div>
    <img id="profileAvatar" src="{{ url_for('static', filename=user.profile_pic) if user.profile_pic else url_for('static', filename='images/perfil.svg') }}" class="profile-avatar mb-3 rounded-circle" alt="Usuario"/>
    <h2 class="profile-name">{{ user.username }}, {{ user.age if user.age else '' }}</h2>
    <p class="profile-status">{{ user.bio if user.bio else '‚ú® LO QUE SURJA' }}</p>
    <a href="{{ url_for('logout') }}" class="btn btn-logout mt-3">Cerrar Sesi√≥n</a>
  </div>

  <!-- Panel principal -->
  <div class="profile-settings text-white p-4 flex-grow-1">
    <form method="POST" action="{{ url_for('perfil') }}" enctype="multipart/form-data">
      <div class="header d-flex align-items-center gap-3 mb-4">
          <img src="{{ url_for('static', filename='images/logo.svg') }}" class="logo-icon" alt="Logo"/>
          <h1 class="logo-text mb-0">FLAMEDATE</h1>
      </div>
      <h3 class="section-title">CONFIGURACI√ìN</h3>

      <!-- Editar fotos -->
      <div class="photo-gallery d-flex gap-3 my-4">
        <img id="profilePreview" src="{{ url_for('static', filename=user.profile_pic) if user.profile_pic else url_for('static', filename='images/perfil.jpg') }}" class="photo-thumb rounded"/>
        <!-- Bot√≥n para a√±adir foto de perfil -->
        <label for="profile_pic" class="photo-thumb add-photo d-flex align-items-center justify-content-center rounded mb-0" style="cursor:pointer;">
          <span class="plus-icon">+</span>
          <input type="file" name="profile_pic" id="profile_pic" class="form-control d-none" accept="image/*" onchange="previewProfilePic(event)"/>
        </label>
      </div>

      <!-- Agrupar todas las secciones horizontalmente -->
      <div class="d-flex flex-wrap align-items-end gap-4 mb-4">
        <!-- Informaci√≥n personal -->
        <div class="info-section">
          <h5 class="mb-3">INFORMACI√ìN PERSONAL</h5>
          <input type="text" name="username" class="form-input me-2" placeholder="Nombre" value="{{ user.username }}"/>
          <input type="number" name="edad" class="form-input" placeholder="Edad" value="{{ user.age if user.age else '' }}"/>
        </div>

        <!-- Intereses -->
        <div class="info-section">
          <h5 class="mb-3">INTERESES</h5>
          <select name="intereses" class="form-select custom-select w-auto d-inline-block me-2">
            <option value="Mujeres" {% if user.preference == 'female' %}selected{% endif %}>Mujeres</option>
            <option value="Hombres" {% if user.preference == 'male' %}selected{% endif %}>Hombres</option>
            <option value="Ambos" {% if user.preference == 'both' %}selected{% endif %}>Ambos</option>
          </select>
        </div>

        <!-- Identidad -->
        <div class="info-section">
          <h5 class="mb-3">ME IDENTIFICO</h5>
          <select name="identidad" class="form-select custom-select w-auto d-inline-block">
            <option value="Heterosexual" {% if user.gender == 'male' %}selected{% endif %}>Heterosexual</option>
            <option value="Homosexual" {% if user.gender == 'female' %}selected{% endif %}>Homosexual</option>
            <option value="Bisexual" {% if user.gender == 'other' %}selected{% endif %}>Bisexual</option>
            <option value="Otro" {% if user.gender == 'other' %}selected{% endif %}>Otro</option>
          </select>
        </div>
      </div>

      <!-- Qu√© buscas -->
      <div class="info-section">
        <h5 class="mb-3">BUSCO...</h5>
        <div class="dot-selector">
          <input type="radio" id="dot-red" name="busca" value="red" hidden {% if user.bio == 'üòç RELACI√ìN ESTABLE' %}checked{% endif %}>
          <label for="dot-red" class="dot-option">
              <span class="dot red"></span> üòç RELACI√ìN ESTABLE
          </label>
          <input type="radio" id="dot-yellow" name="busca" value="yellow" hidden {% if user.bio == 'üòÖ ROLLOS CORTOS' %}checked{% endif %}>
          <label for="dot-yellow" class="dot-option">
              <span class="dot yellow"></span> üòÖ ROLLOS CORTOS
          </label>
          <input type="radio" id="dot-blue" name="busca" value="blue" hidden {% if user.bio == 'ü§ù HACER AMIGOS' %}checked{% endif %}>
          <label for="dot-blue" class="dot-option">
              <span class="dot blue"></span> ü§ù HACER AMIGOS
          </label>
          <input type="radio" id="dot-sparkle" name="busca" value="sparkle" hidden {% if user.bio == '‚ú® LO QUE SURJA' or not user.bio %}checked{% endif %}>
          <label for="dot-sparkle" class="dot-option">
              <span class="dot sparkle"></span> ‚ú® LO QUE SURJA
          </label>
        </div>
      </div>

      <!-- Bot√≥n para actualizar -->
      <div class="text-end mt-4">
        <button type="submit" class="btn btn-danger rounded-pill px-4 py-2 fw-semibold">Actualizar</button>
      </div>
    </form>
  </div>
</div>
<script>
function previewProfilePic(event) {
  const input = event.target;
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      // Cambia tanto el preview de la galer√≠a como el avatar lateral
      document.getElementById('profilePreview').src = e.target.result;
      // Solo cambia el avatar lateral si no hay foto previa (es la default)
      const avatar = document.getElementById('profileAvatar');
      if (
        avatar.src.endsWith('perfil.svg') ||
        avatar.src.endsWith('perfil.jpg') ||
        avatar.src.endsWith('perfil.png') ||
        avatar.src.includes('default') // por si tienes otro nombre de default
      ) {
        avatar.src = e.target.result;
      }
    }
    reader.readAsDataURL(input.files[0]);
  }
}
</script>
{% endblock %}